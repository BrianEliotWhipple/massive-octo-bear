# -*- mode: ruby -*-
# vi: set ft=ruby :

# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
VAGRANTFILE_API_VERSION = '2'

# Can be 7 or 8
java_version = '8'

# Can be 2.0 or 2.1
cassandra_version = '2.1'

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  config.vm.box = 'ubuntu/trusty64'

  # Create a private network, which allows host-only access to the machine
  # using a specific IP.
  config.vm.network 'private_network', ip: '192.168.12.100'
  config.vm.synced_folder '../../services', '/services'

  config.vm.provider 'virtualbox' do |vb|
    config.vm.provider 'virtualbox' do |vb|
      vb.memory = 1024
      vb.cpus = 2
    end
  end

  $script = <<SCRIPT
    sudo echo DOCKER_OPTS=\\"\\$DOCKER_OPTS --insecure-registry 192.168.0.0/16\\" >> /etc/default/docker
SCRIPT

  config.vm.provision 'shell', inline: $script

  config.vm.provision 'docker' do | d |
    d.pull_images 'registry:0.9.1'
    d.pull_images 'google/cadvisor:latest'
    d.pull_images 'debian:jessie'
    d.pull_images "java:#{java_version}"
    d.pull_images "cassandra:#{cassandra_version}"

    d.run 'cassandra:2.1',
          args: '--name cassandra-1 -p 9042:9042',
        daemonize: true

    d.run 'registry:0.9.1',
          args: '--name docker-registry -p 5000:5000',
        daemonize: true

  end

end
